<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Toolkit For Flow-Dependent outcomes in the Murray-Darling Basin • HydroBOT</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Toolkit For Flow-Dependent outcomes in the Murray-Darling Basin">
<meta name="description" content="Provides tools to assess responses to flows in the MDB. Wraps the EWR tool and provides ongoing modeling of ecological responses with causal networks, as well as analysis, synthesis and visualisation functionality targetted at scenario comparisons.">
<meta property="og:description" content="Provides tools to assess responses to flows in the MDB. Wraps the EWR tool and provides ongoing modeling of ecological responses with causal networks, as well as analysis, synthesis and visualisation functionality targetted at scenario comparisons.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">HydroBOT</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2.9026</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="hydrobot">HydroBOT<a class="anchor" aria-label="anchor" href="#hydrobot"></a>
</h1></div>
<!-- badges: start -->

<!-- badges: end -->
<p>This R package forms the core of the WERP climate adaptation toolkit (HydroBOT), ingesting hydrological scenarios representing historical or future climates or adaptation options, and processing those through various response models (currently <a href="https://github.com/MDBAuth/EWR_tool" class="external-link">MDBA EWR tool</a>, with intention to include other tools in future). Subsequent processing of outcomes along spatial, theme, and temporal axes are available, as well as control over outputs and comparisons between scenarios. Causal networks defining relationships in the response models are included, though in general the current versions should be obtained from the EWR tool directly with <code><a href="reference/get_causal_ewr.html">get_causal_ewr()</a></code>.</p>
<div id="doc_site" style="color: red">
<p><strong><em>See the <a href="https://mdbauth.github.io/HydroBOT_website/" class="external-link">documentation website</a> for more installation instructions and examples.</em></strong></p>
</div>
<p>The <a href="https://github.com/MDBAuth/toolkit_use" class="external-link">template repo</a> can be helpful for establishing project structure to use the HydroBOT and automating the setup process, particularly if you are on Linux or want to manage your python environments.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install the development version of HydroBOT from <a href="https://github.com/MDBAuth/HydroBOT" class="external-link">GitHub</a> with</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_git</span><span class="op">(</span><span class="st">"git@github.com:MDBAuth/HydroBOT.git"</span>, ref <span class="op">=</span> <span class="st">'master'</span>, force <span class="op">=</span> <span class="cn">TRUE</span>, upgrade <span class="op">=</span> <span class="st">'ask'</span>, git <span class="op">=</span> <span class="st">'external'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://laughing-adventure-8jypg4z.pages.github.io/">HydroBOT</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: sf</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.3.1; sf_use_s2() is TRUE</span></span></code></pre></div>
<div id="install-note" style="color: gray">
<p>R uses a different Home directory than standard (typically <code>~/Documents</code>), and so if this fails, try to <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent" class="external-link">set up SSH keys</a> in that location as well.</p>
<p>There are slightly slicker ways to do it, but they don’t work well currently. See <a href="developer.html">developer docs</a> for details or if the above doesn’t work.</p>
</div>
<div id="py-install" style="color: gray">
<div class="section level3">
<h3 id="python-dependency">Python dependency<a class="anchor" aria-label="anchor" href="#python-dependency"></a>
</h3>
<p>To run, this needs a Python environment containing <code>py_ewr</code> (currently py-ewr 2.3.7). The package will manage that for you if you just start using it- on first use, the package checks the environment and either uses an existing python environment or builds one with that dependency when the package is loaded.</p>
<p>There are <code>poetry.lock</code> and <code>pyproject.toml</code> files in the repo that allow for dev work and building the venv manually if more control over python is desired.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="use">Use<a class="anchor" aria-label="anchor" href="#use"></a>
</h2>
<p>HydroBOT can be run piecemeal or all at once, scripted. Point it at a directory of hydrologic scenarios, and HydroBOT will run them through the modules, aggregate the outputs, and present results, with control by the user through function arguments. Each stage builds a runnable set of parameter metadata based on function arguments for tracking provenance and reproducibility. Typical approaches use R scripts, Quarto notebooks, or automation on HPC or azure systems with yaml parameter files and shell/R scripts.</p>
<p>See the <a href="https://mdbauth.github.io/HydroBOT_website/" class="external-link">HydroBOT documentation website</a> for a full demonstration and the <a href="https://github.com/MDBAuth/toolkit_use" class="external-link">template repo</a> for a bare-bones project structure.</p>
<p>Using HydroBOT is typically a three-step process:</p>
<ol style="list-style-type: decimal">
<li>
<p>Running hydrographs through the EWR tool (or future modules) with <code><a href="reference/prep_run_save_ewrs.html">prep_run_save_ewrs()</a></code>.</p>
<ul>
<li>Best practice has hydrographs in directories defined by scenarios, so all hydrographs within a scenario can be run at once, parallelised over scenarios.</li>
</ul>
</li>
<li>
<p>Aggregating module outputs to larger theme, spatial, and temporal scales with <code><a href="reference/read_and_agg.html">read_and_agg()</a></code></p>
<ul>
<li><p><code><a href="reference/read_and_agg.html">read_and_agg()</a></code> maintains dimensional safety over theme, temporal, and spatial dimensions, avoiding the collapse over unintended dimensions that is quite easy to miss if manually using e.g. <code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">dplyr::summarise()</a></code>.</p></li>
<li><p><code><a href="reference/read_and_agg.html">read_and_agg()</a></code> (and wrapped functions for dimensional aggregation) provide the ability to retain groupings and do non-spatial joins of spatial data. This allows them to be EWR-aware, and provide warnings and automation for best-practice automation of EWR aggregation that does not collapse planning and sdl units too soon and join gauges to them non-spatially. The easiest way to use this is with <code>auto_ewr_PU = TRUE</code> .</p></li>
<li><p>It is expected that <code><a href="reference/read_and_agg.html">read_and_agg()</a></code> may be run several times for a given analysis, with several different aggregation sequences, as different sets may be needed for different questions, or iterative production of results identifies better approaches.</p></li>
</ul>
</li>
<li>
<p>Developing output products targeting the question of interest (typically a scenario comparison) with <code><a href="reference/plot_outcomes.html">plot_outcomes()</a></code> and <code><a href="reference/baseline_compare.html">baseline_compare()</a></code></p>
<ul>
<li><p><code><a href="reference/plot_outcomes.html">plot_outcomes()</a></code> provides consistent processing and analysis of input and output data, compared to manually building ggplots</p></li>
<li><p><code><a href="reference/plot_outcomes.html">plot_outcomes()</a></code> is theme, space, and time-aware, and so prevents accidental overplotting or other losses of dimensional data.</p></li>
<li><p>The return from <code><a href="reference/plot_outcomes.html">plot_outcomes()</a></code> is a ggplot object, which can then be tweaked as usual.</p></li>
</ul>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="example-run">Example run<a class="anchor" aria-label="anchor" href="#example-run"></a>
</h2>
<p>A simple run of HydroBOT with the provided example data works as follows. See the <a href="https://mdbauth.github.io/HydroBOT_website" class="external-link">documentation website</a> for much more detail.</p>
<p>Any real run should think carefully about the aggregation and plotting decisions. For much more detail about setting up runs, see the <a href="https://https://mdbauth.github.io/HydroBOT_website/workflows/workflow_overview" class="external-link">documentation</a>.</p>
<p>The path to the hydrographs</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hydro_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/testsmall/hydrographs"</span>, package <span class="op">=</span> <span class="st">"HydroBOT"</span><span class="op">)</span></span></code></pre></div>
<p>Run the EWR tool and return the output to memory, rather than saving for this small example. See <a href="mdbauth.github.io/HydroBOT_website/controller/controller_overview">documentation</a> for more details</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ewr_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/prep_run_save_ewrs.html">prep_run_save_ewrs</a></span><span class="op">(</span></span>
<span>  hydro_dir <span class="op">=</span> <span class="va">hydro_dir</span>,</span>
<span>  output_parent_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  outputType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"none"</span><span class="op">)</span>,</span>
<span>  returnType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"yearly"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Set up the aggregation steps, see <a href="https://mdbauth.github.io/HydroBOT_website/aggregator/aggregation_overview" class="external-link">documentation</a> for more detail.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aggseq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  all_time <span class="op">=</span> <span class="st">"all_time"</span>,</span>
<span>  ewr_code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ewr_code_timing"</span>, <span class="st">"ewr_code"</span><span class="op">)</span>,</span>
<span>  env_obj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ewr_code"</span>, <span class="st">"env_obj"</span><span class="op">)</span>,</span>
<span>  sdl_units <span class="op">=</span> <span class="va">sdl_units</span>,</span>
<span>  Target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"env_obj"</span>, <span class="st">"Target"</span><span class="op">)</span>,</span>
<span>  mdb <span class="op">=</span> <span class="va">basin</span>,</span>
<span>  target_5_year_2024 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Target"</span>, <span class="st">"target_5_year_2024"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">funseq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  all_time <span class="op">=</span> <span class="st">"ArithmeticMean"</span>,</span>
<span>  ewr_code <span class="op">=</span> <span class="st">"CompensatingFactor"</span>,</span>
<span>  env_obj <span class="op">=</span> <span class="st">"ArithmeticMean"</span>,</span>
<span>  sdl_units <span class="op">=</span> <span class="st">"ArithmeticMean"</span>,</span>
<span>  Target <span class="op">=</span> <span class="st">"ArithmeticMean"</span>,</span>
<span>  mdb <span class="op">=</span> <span class="st">"SpatialWeightedMean"</span>,</span>
<span>  target_5_year_2024 <span class="op">=</span> <span class="st">"ArithmeticMean"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Do the multi-dimensional aggregation, again just returning to memory.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aggout</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_and_agg.html">read_and_agg</a></span><span class="op">(</span></span>
<span>  datpath <span class="op">=</span> <span class="va">ewr_out</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"achievement"</span>,</span>
<span>  geopath <span class="op">=</span> <span class="va">bom_basin_gauges</span>,</span>
<span>  causalpath <span class="op">=</span> <span class="va">causal_ewr</span>,</span>
<span>  groupers <span class="op">=</span> <span class="st">"scenario"</span>,</span>
<span>  aggCols <span class="op">=</span> <span class="st">"ewr_achieved"</span>,</span>
<span>  auto_ewr_PU <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  aggsequence <span class="op">=</span> <span class="va">aggseq</span>,</span>
<span>  funsequence <span class="op">=</span> <span class="va">funseq</span>,</span>
<span>  saveintermediate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  namehistory <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  keepAllPolys <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  returnList <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  add_max <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>A couple figures to check it worked, see <a href="https://mdbauth.github.io/HydroBOT_website/comparer/comparer_overview" class="external-link">documentation</a> for more detail.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_example</span> <span class="op">&lt;-</span> <span class="va">aggout</span><span class="op">$</span><span class="va">Target</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># dplyr::filter(env_obj == "NF1") |&gt; # Need to reduce dimensionality</span></span>
<span>  <span class="fu"><a href="reference/plot_outcomes.html">plot_outcomes</a></span><span class="op">(</span></span>
<span>    outcome_col <span class="op">=</span> <span class="st">"ewr_achieved"</span>,</span>
<span>    plot_type <span class="op">=</span> <span class="st">"map"</span>,</span>
<span>    colorset <span class="op">=</span> <span class="st">"ewr_achieved"</span>,</span>
<span>    pal_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"scico::lapaz"</span><span class="op">)</span>,</span>
<span>    pal_direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>    facet_col <span class="op">=</span> <span class="st">"Target"</span>,</span>
<span>    facet_row <span class="op">=</span> <span class="st">"scenario"</span>,</span>
<span>    sceneorder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"down4"</span>, <span class="st">"base"</span>, <span class="st">"up4"</span><span class="op">)</span>,</span>
<span>    underlay_list <span class="op">=</span> <span class="st">"basin"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">map_example</span></span></code></pre></div>
<p><img src="reference/figures/README-map-1.png" width="100%"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">catchcompare</span> <span class="op">&lt;-</span> <span class="va">aggout</span><span class="op">$</span><span class="va">env_obj</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="reference/plot_outcomes.html">plot_outcomes</a></span><span class="op">(</span></span>
<span>    outcome_col <span class="op">=</span> <span class="st">"ewr_achieved"</span>,</span>
<span>    colorset <span class="op">=</span> <span class="st">"SWSDLName"</span>,</span>
<span>    pal_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"calecopal::lake"</span><span class="op">)</span>,</span>
<span>    sceneorder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"down4"</span>, <span class="st">"base"</span>, <span class="st">"up4"</span><span class="op">)</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"dodge"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">catchcompare</span></span></code></pre></div>
<p><img src="reference/figures/README-bar-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="development">Development<a class="anchor" aria-label="anchor" href="#development"></a>
</h2>
<p><a href="developer.html">see developer page</a></p>
</div>
<div class="section level2">
<h2 id="further-examples">Further examples<a class="anchor" aria-label="anchor" href="#further-examples"></a>
</h2>
<p>See the <a href="https://mdbauth.github.io/HydroBOT_website/" class="external-link">HydroBOT website</a> for a full demonstration.</p>
</div>
<div class="section level2">
<h2 id="who-do-i-talk-to">Who do I talk to?<a class="anchor" aria-label="anchor" href="#who-do-i-talk-to"></a>
</h2>
<ul>
<li>Galen Holt, <a href="mailto:g.holt@deakin.edu.au" class="email">g.holt@deakin.edu.au</a>
</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing HydroBOT</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Galen Holt <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-7455-9275" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Georgia Dwyer <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/MDBAuth/HydroBOT/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/MDBAuth/HydroBOT/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/MDBAuth/HydroBOT" class="external-link"><img src="https://codecov.io/gh/MDBAuth/HydroBOT/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Galen Holt, Georgia Dwyer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
